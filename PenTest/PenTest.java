package PenTest;

import java.util.ArrayList;
import java.util.HashMap;

public class PenTest {
	
	static String urlString;

	public static void main(String[] args) {

		if((args == null || args.length == 0))
		{
			urlString = "http://localhost/theatmojo.com";			
		}
		else
		{
			urlString = args[0];			
		}

		Integer	 i = 0;

		for(i = 0; i < 1; i++)
		{
			System.out.println("attempt " + i);

			/*	define the output directory	*/
			String outputDir = "output/"+urlString.replaceAll("[:\\/]+", "-");

			/*	create the output directory	*/
			FileInterface.createDir(outputDir);

			/*	identify the host ip address	*/
			String ipAddress = HostIdentifier.getIpAddress(urlString);
			FileInterface.writeTimestamp(outputDir+"/"+"output.log", "ipAddress: "+ ipAddress);	

			/*	identify the hostname	*/
			String hostname = HostIdentifier.getHostname(ipAddress);
			FileInterface.writeTimestamp(outputDir+"/"+"output.log", "hostname: "+ hostname);	

			/*	identify the ftp banner	*/
			String ftpBanner = HostIdentifier.getFtpBanner(ipAddress);
			FileInterface.writeTimestamp(outputDir+"/"+"output.log", "ftpBanner: "+ ftpBanner);	


			HashMap<String, Object> fetchResult = UrlFetch.get(urlString);


			/*	identify the server technology	*/
			String server = HeaderCrawler.getServer((HashMap<String, Object>) fetchResult.get("header"));
			FileInterface.writeTimestamp(outputDir+"/"+"output.log", "server: "+ server);	

			String content = (String) fetchResult.get("content");

			ArrayList<String> output = ContentFinder.findUrl(content);
			for (int j = 0; j < output.size(); j++) {
				FileInterface.writeTimestamp(outputDir+"/"+"output.log", "url: "+output.get(j));
			}

			output = ContentFinder.findScript(content);
			System.out.println(output);
			for (int j = 0; j < output.size(); j++) {

				FileInterface.writeTimestamp(outputDir+"/"+"output.log", "script: "+output.get(j));

				HashMap<String, Object> scriptFetch = UrlFetch.get(output.get(j));

				String scriptContent = (String) scriptFetch.get("content"); 

				ArrayList<String> scriptComment = ContentFinder.findComment(scriptContent);


				for(int k = 0; k < scriptComment.size(); k++)
				{
					FileInterface.writeTimestamp(outputDir+"/"+"output.log", "scriptComment: "+scriptComment.get(k));
				}

			}

			output = ContentFinder.findStyle(content);

			for (int j = 0; j < output.size(); j++) {
				FileInterface.writeTimestamp(outputDir+"/"+"output.log", "style: "+output.get(j));
			}

			output = ContentFinder.findImage(content);

			for (int j = 0; j < output.size(); j++) {
				FileInterface.writeTimestamp(outputDir+"/"+"output.log", "image: "+output.get(j));
			}

			output = ContentFinder.findComment(content);

			for (int j = 0; j < output.size(); j++) {
				FileInterface.writeTimestamp(outputDir+"/"+"output.log", "comment: "+output.get(j));
			}

			output = ContentFinder.findHtmlComment(content);

			for (int j = 0; j < output.size(); j++) {
				FileInterface.writeTimestamp(outputDir+"/"+"output.log", "htmlComment: "+output.get(j));
			}
		}

	}

}

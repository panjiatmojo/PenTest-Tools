package PenTest;

import java.io.BufferedReader;
import java.io.IOException;
import java.io.InputStream;
import java.io.InputStreamReader;
import java.io.PrintWriter;
import java.net.InetAddress;
import java.net.MalformedURLException;
import java.net.Socket;
import java.net.SocketException;
import java.net.URL;
import java.net.UnknownHostException;

import com.jcraft.jsch.ChannelSftp;
import com.jcraft.jsch.JSch;
import com.jcraft.jsch.Session;

public class HostIdentifier {

	static String getIpAddress(String urlString)
	{

		InetAddress address = null;
		try {
			address = InetAddress.getByName(new URL(urlString).getHost());
		} catch (UnknownHostException e) {
			e.printStackTrace();
		} catch (MalformedURLException e) {
			e.printStackTrace();
		}

		return address.getHostAddress();
	}

	static String getFtpBanner(String ipAddress)
	{
		Socket socket = null;
		try {
			socket = new Socket(ipAddress, 21);
		} catch (Exception e) {
			e.printStackTrace();
		} 

		try {
			socket.setKeepAlive(true);
		} catch (SocketException e) {
			e.printStackTrace();
		}
		
		BufferedReader r = null;

		try {
			r = new BufferedReader(new InputStreamReader(socket.getInputStream()));
		} catch (IOException e) {
			e.printStackTrace();
		}
		try {
			PrintWriter w = new PrintWriter(socket.getOutputStream(),true);
		} catch (IOException e) {
			e.printStackTrace();
		}

		String banner = "";
		try {
			while(r.ready())
			{
				banner += r.readLine();
			}
		} catch (IOException e) {
			e.printStackTrace();
		}
		try {
			socket.close();
		} catch (IOException e) {
			e.printStackTrace();
		}
		return banner;
	}

	static String getSshBanner(String ipAddress)
	{
		String user = "";
		String password = "";
		String host = ipAddress;
		Integer port = 22;
		String remoteFile = "";
		String line = null;

		try
		{
			JSch jsch = new JSch();
			Session session = jsch.getSession(user, host, port);
			session.setPassword(password);
			session.setConfig("StrictHostKeyChecking", "no");
			System.out.println("Establishing Connection...");
			session.connect();
			System.out.println("Connection established.");
			System.out.println("Crating SFTP Channel.");
			ChannelSftp sftpChannel = (ChannelSftp) session.openChannel("sftp");
			sftpChannel.connect();
			System.out.println("SFTP Channel created.");


			InputStream out= null;
			out= sftpChannel.get(remoteFile);
			BufferedReader br = new BufferedReader(new InputStreamReader(out));
			while ((line = br.readLine()) != null)
				System.out.println(line);
			br.close();
		}
		catch(Exception e){System.err.print(e);}

		return line;
	}

}
